{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>Productos registrados</h4>
  <a href="{{ url_for('main.nuevo_producto') }}" class="btn btn-primary">
    <i class="bi bi-plus-lg"></i> Agregar producto
  </a>
</div>

<table class="table table-striped align-middle bg-white shadow-sm">
  <thead class="table-light">
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Categoría</th>
      <th>Proveedor</th>
      <th>Unidad</th>
      <th>Stock</th>
      <th>Precio</th>
      <th>Estado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for p in productos %}
    <tr {% if p.stock <= p.stock_minimo %}class="table-danger"{% endif %}>
      <td>{{ p.id }}</td>
      <td>{{ p.nombre }}</td>
      <td>{{ p.categoria }}</td>
      <td>{{ p.proveedor }}</td>
      <td>{{ p.unidad }}</td>
      <td>
        {{ p.stock }}
        {% if p.stock <= p.stock_minimo %}
          <span class="badge bg-danger ms-2">¡Bajo stock!</span>
        {% endif %}
      </td>
      <td>S/. {{ "%.2f"|format(p.precio) }}</td>
      <td>{{ p.estado }}</td>
      <td>
        <div class="btn-group btn-group-sm" role="group">
          <!-- Botón Editar -->
          <a href="{{ url_for('main.editar_producto', id=p.id) }}" class="btn btn-outline-warning" title="Editar">
            <i class="bi bi-pencil"></i>
          </a>
          
          <!-- Botón Reabastecer -->
          <a href="{{ url_for('main.reabastecer_inventario') }}?producto_id={{ p.id }}" 
             class="btn btn-outline-success" title="Reabastecer">
            <i class="bi bi-plus-circle"></i>
          </a>
          
          <!-- Botón Activar/Desactivar -->
          {% if p.estado == 'Activo' %}
            <a href="{{ url_for('main.toggle_estado_producto', id=p.id, estado_actual=p.estado) }}"
               class="btn btn-outline-danger" title="Desactivar producto">
               <i class="bi bi-x-circle"></i>
            </a>
          {% else %}
            <a href="{{ url_for('main.toggle_estado_producto', id=p.id, estado_actual=p.estado) }}"
               class="btn btn-outline-success" title="Activar producto">
               <i class="bi bi-check-circle"></i>
            </a>
          {% endif %}
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}